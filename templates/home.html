{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h1>

  <div class="alert alert-info" role="alert">
    üßò –ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –≤—ã –æ—Ç–¥—ã—Ö–∞–ª–∏ <strong>{{ weekly_minutes }}</strong> –º–∏–Ω—É—Ç.
  </div>

  <div class="mb-4 d-flex gap-3 flex-wrap">
    <a href="{% url 'select_exercise' %}" class="btn btn-success btn-lg">–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é</a>
    <a href="{% url 'restsession_list' %}" class="btn btn-outline-primary btn-lg">–ú–æ–∏ —Å–µ—Å—Å–∏–∏</a>
  </div>

  {% if active_sessions %}
    <h3 class="mt-5">üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏</h3>
    <div class="list-group mb-4">
      {% for session in active_sessions %}
        <div class="list-group-item d-flex align-items-center">
          {% if session.meditation %}
            <img src="{{ session.meditation.image.url }}" alt="{{ session.meditation.title }}" width="80" class="me-3 rounded">
            <div>
              <h5>{{ session.meditation.title }}</h5>
              <p class="mb-0 text-muted">–¢–∏–ø: –ú–µ–¥–∏—Ç–∞—Ü–∏—è</p>
          {% elif session.breathing_exercise %}
            <img src="{{ session.breathing_exercise.image.url }}" alt="{{ session.breathing_exercise.title }}" width="80" class="me-3 rounded">
            <div>
              <h5>{{ session.breathing_exercise.title }}</h5>
              <p class="mb-0 text-muted">–¢–∏–ø: –î—ã—Ö–∞—Ç–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
          {% endif %}
              <p class="mb-0">–ù–∞—á–∞—Ç–∞: {{ session.start_time|date:"d M Y H:i" }}</p>
              <form method="post" action="{% url 'end_session_now' session.pk %}" class="mt-2">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
              </form>
            </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <h3 class="mt-5">üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏</h3>
  <div class="list-group">
    {% for session in completed_sessions|slice:":5" %}
      <div class="list-group-item d-flex align-items-center">
        {% if session.meditation %}
          <img src="{{ session.meditation.image.url }}" alt="{{ session.meditation.title }}" width="80" class="me-3 rounded">
          <div>
            <h5>{{ session.meditation.title }}</h5>
            <p class="mb-0 text-muted">–¢–∏–ø: –ú–µ–¥–∏—Ç–∞—Ü–∏—è</p>
        {% elif session.breathing_exercise %}
          <img src="{{ session.breathing_exercise.image.url }}" alt="{{ session.breathing_exercise.title }}" width="80" class="me-3 rounded">
          <div>
            <h5>{{ session.breathing_exercise.title }}</h5>
            <p class="mb-0 text-muted">–¢–∏–ø: –î—ã—Ö–∞—Ç–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
        {% endif %}
            <p class="mb-0">–ù–∞—á–∞–ª–æ: {{ session.start_time|date:"d M Y H:i" }}</p>
            <p class="mb-0">–ó–∞–≤–µ—Ä—à–µ–Ω–æ: {{ session.end_time|date:"d M Y H:i" }}</p>
          </div>
      </div>
    {% empty %}
      <p class="text-muted">–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
